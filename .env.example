# label-verify-hw Environment Configuration
# Copy this file to .env and fill in your actual values
# NEVER commit .env to git - it contains sensitive credentials

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================

# Server bind address (default: 0.0.0.0:3000)
BIND_ADDR=0.0.0.0:3000

# =============================================================================
# CLOUDFLARE WORKERS AI
# =============================================================================

# Your Cloudflare account ID (find in dashboard sidebar)
# Example: abc123def456789012345678901234
CF_ACCOUNT_ID=your_account_id_here

# Workers AI API token (scoped to Workers AI → Read)
# Generate at: https://dash.cloudflare.com/profile/api-tokens
# Token name suggestion: label-verify-{env}-workers-ai
CF_API_TOKEN=your_workers_ai_api_token_here

# =============================================================================
# CLOUDFLARE R2 STORAGE
# =============================================================================

# R2 bucket name (environment-specific)
# Development: label-verify-dev
# Testing: label-verify-test
# Staging: label-verify-staging
# Production: label-verify-prod
R2_BUCKET=label-verify-dev

# R2 Access Key ID
# Generate at: R2 Dashboard → Manage R2 API Tokens
R2_ACCESS_KEY=your_r2_access_key_id_here

# R2 Secret Access Key (keep this secret!)
R2_SECRET_KEY=your_r2_secret_access_key_here

# R2 endpoint URL (replace with your account ID)
# Format: https://<account-id>.r2.cloudflarestorage.com
R2_ENDPOINT=https://your_account_id.r2.cloudflarestorage.com

# =============================================================================
# DATABASE
# =============================================================================

# PostgreSQL connection string
# Development example: postgresql://localhost:5432/labelverify_dev
# Production example: postgresql://user:pass@host:5432/labelverify_prod?sslmode=require
DATABASE_URL=postgresql://localhost:5432/labelverify_dev

# =============================================================================
# REDIS (Job Queue)
# =============================================================================

# Redis connection string
# Development example: redis://localhost:6379
# Production example: rediss://user:pass@host:6380/0
REDIS_URL=redis://localhost:6379

# =============================================================================
# ENCRYPTION
# =============================================================================

# AES-256-GCM encryption key (32 bytes, base64-encoded)
# Generate with: openssl rand -base64 32
# CRITICAL: Keep this secret and back it up securely!
# Losing this key means you cannot decrypt stored images.
ENCRYPTION_KEY=base64_encoded_32_byte_key_here

# =============================================================================
# AZURE AD (JWT Validation)
# =============================================================================

# Azure Active Directory tenant ID
# Find in: Azure Portal → Azure Active Directory → Properties
AZURE_TENANT_ID=your_azure_tenant_id_here

# Azure AD application (client) ID
# Find in: Azure Portal → App registrations → Your app → Overview
AZURE_CLIENT_ID=your_azure_client_id_here

# =============================================================================
# OPTIONAL CONFIGURATION
# =============================================================================

# Log level (trace, debug, info, warn, error)
# RUST_LOG=label_verify_hw=debug,tower_http=debug

# Metrics export port (Prometheus)
# METRICS_PORT=9090

# Max request body size (bytes)
# MAX_BODY_SIZE=10485760

# Request timeout (seconds)
# REQUEST_TIMEOUT=30

# =============================================================================
# ENVIRONMENT-SPECIFIC NOTES
# =============================================================================

# DEVELOPMENT:
# - Use local PostgreSQL and Redis instances
# - R2_BUCKET should be label-verify-dev
# - Consider using separate Cloudflare account for isolation
# - Estimated cost: ~$5-10/month

# TESTING (CI/CD):
# - Store these as CI/CD secrets (GitHub Secrets, GitLab Variables, etc.)
# - R2_BUCKET should be label-verify-test
# - Set R2 lifecycle policy to auto-delete objects >7 days
# - Never print secrets in CI logs
# - Estimated cost: ~$1-5/month

# STAGING (PRE-PRODUCTION):
# - Store in secret management system (AWS Secrets Manager, Vault, etc.)
# - R2_BUCKET should be label-verify-staging
# - Mirror production configuration exactly
# - Rotate credentials quarterly
# - Estimated cost: ~$15-60/month

# PRODUCTION:
# - Use managed secret storage (never .env files)
# - R2_BUCKET should be label-verify-prod
# - Enable audit logging
# - Implement automated token rotation
# - Set up monitoring and alerting

# =============================================================================
# SECURITY CHECKLIST
# =============================================================================

# ✅ .env file is in .gitignore (never commit to git)
# ✅ Use scoped API tokens (not global API keys)
# ✅ Enable token expiration (90 days for dev, longer for prod)
# ✅ Rotate credentials regularly
# ✅ Monitor for leaked credentials (GitHub secret scanning)
# ✅ Back up ENCRYPTION_KEY securely (losing it means data loss)
# ✅ Use separate credentials per environment
# ✅ Implement least privilege access control

# =============================================================================
# QUICK START
# =============================================================================

# 1. Copy this file:
#    cp .env.example .env

# 2. Follow the setup guide:
#    docs/CLOUDFLARE_SETUP.md

# 3. Fill in all values above

# 4. Verify .env is in .gitignore:
#    grep -q "^\.env$" .gitignore && echo "✅ Safe" || echo "❌ Add .env to .gitignore!"

# 5. Test configuration:
#    cargo run

# 6. Test Workers AI connection:
#    curl -X POST https://api.cloudflare.com/client/v4/accounts/$CF_ACCOUNT_ID/ai/run/@cf/llava-hf/llava-1.5-7b-hf \
#      -H "Authorization: Bearer $CF_API_TOKEN" \
#      -d '{"prompt":"test","image":"<base64>","max_tokens":10}'
